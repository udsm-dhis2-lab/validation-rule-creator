{"ast":null,"code":"import _JSXStyle from \"styled-jsx/style\";\nimport { useDataQuery, useConfig } from '@dhis2/app-runtime';\nimport { colors } from '@dhis2/ui-constants';\nimport PropTypes from 'prop-types';\nimport React, { useMemo } from 'react';\nimport i18n from '../locales/index.js';\nimport Apps from './Apps.js';\nimport { joinPath } from './joinPath.js';\nimport { Logo } from './Logo.js';\nimport { Notifications } from './Notifications.js';\nimport Profile from './Profile.js';\nimport { Title } from './Title.js';\nconst query = {\n  title: {\n    resource: 'systemSettings/applicationTitle'\n  },\n  help: {\n    resource: 'systemSettings/helpPageLink'\n  },\n  user: {\n    resource: 'me',\n    params: {\n      fields: ['authorities', 'avatar', 'email', 'name', 'settings']\n    }\n  },\n  apps: {\n    resource: 'action::menu/getModules'\n  },\n  notifications: {\n    resource: 'me/dashboard'\n  }\n};\n\nconst avatarUrl = (avatar, baseUrl) => avatar ? joinPath(baseUrl, 'api/fileResources', avatar.id, 'data') : null;\n\nexport const HeaderBar = ({\n  appName,\n  className\n}) => {\n  const {\n    baseUrl\n  } = useConfig();\n  const {\n    loading,\n    error,\n    data\n  } = useDataQuery(query);\n  const apps = useMemo(() => {\n    const getPath = path => path.startsWith('http:') || path.startsWith('https:') ? path : joinPath(baseUrl, 'api', path);\n\n    return data === null || data === void 0 ? void 0 : data.apps.modules.map(app => ({ ...app,\n      icon: getPath(app.icon),\n      defaultAction: getPath(app.defaultAction)\n    }));\n  }, [data]);\n\n  if (!loading && !error) {\n    // TODO: This will run every render which is probably wrong!  Also, setting the global locale shouldn't be done in the headerbar\n    const locale = data.user.settings.keyUiLocale || 'en';\n    i18n.setDefaultNamespace('default');\n    i18n.changeLanguage(locale);\n  }\n\n  return /*#__PURE__*/React.createElement(\"header\", {\n    className: _JSXStyle.dynamic([[\"1335571883\", [colors.white]]]) + \" \" + (className || \"\")\n  }, !loading && !error && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Logo, null), /*#__PURE__*/React.createElement(Title, {\n    app: appName,\n    instance: data.title.applicationTitle\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: _JSXStyle.dynamic([[\"1335571883\", [colors.white]]]) + \" \" + \"right-control-spacer\"\n  }), /*#__PURE__*/React.createElement(Notifications, {\n    interpretations: data.notifications.unreadInterpretations,\n    messages: data.notifications.unreadMessageConversations,\n    userAuthorities: data.user.authorities\n  }), /*#__PURE__*/React.createElement(Apps, {\n    apps: apps\n  }), /*#__PURE__*/React.createElement(Profile, {\n    name: data.user.name,\n    email: data.user.email,\n    avatarUrl: avatarUrl(data.user.avatar, baseUrl),\n    helpUrl: data.help.helpPageLink\n  })), /*#__PURE__*/React.createElement(_JSXStyle, {\n    id: \"1335571883\",\n    dynamic: [colors.white]\n  }, [\"header.__jsx-style-dynamic-selector{background-color:#2c6693;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;height:48px;border-bottom:1px solid rgba(32,32,32,0.15);color:\".concat(colors.white, \";}\"), \".right-control-spacer.__jsx-style-dynamic-selector{margin-left:auto;}\"]));\n};\nHeaderBar.propTypes = {\n  appName: PropTypes.string,\n  className: PropTypes.string\n};","map":{"version":3,"sources":["/Users/rajabu/.config/yarn/global/node_modules/@dhis2/ui/node_modules/@dhis2/ui-widgets/build/es/HeaderBar/HeaderBar.js"],"names":["_JSXStyle","useDataQuery","useConfig","colors","PropTypes","React","useMemo","i18n","Apps","joinPath","Logo","Notifications","Profile","Title","query","title","resource","help","user","params","fields","apps","notifications","avatarUrl","avatar","baseUrl","id","HeaderBar","appName","className","loading","error","data","getPath","path","startsWith","modules","map","app","icon","defaultAction","locale","settings","keyUiLocale","setDefaultNamespace","changeLanguage","createElement","dynamic","white","Fragment","instance","applicationTitle","interpretations","unreadInterpretations","messages","unreadMessageConversations","userAuthorities","authorities","name","email","helpUrl","helpPageLink","concat","propTypes","string"],"mappings":"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","sourcesContent":["import _JSXStyle from \"styled-jsx/style\";\nimport { useDataQuery, useConfig } from '@dhis2/app-runtime';\nimport { colors } from '@dhis2/ui-constants';\nimport PropTypes from 'prop-types';\nimport React, { useMemo } from 'react';\nimport i18n from '../locales/index.js';\nimport Apps from './Apps.js';\nimport { joinPath } from './joinPath.js';\nimport { Logo } from './Logo.js';\nimport { Notifications } from './Notifications.js';\nimport Profile from './Profile.js';\nimport { Title } from './Title.js';\nconst query = {\n  title: {\n    resource: 'systemSettings/applicationTitle'\n  },\n  help: {\n    resource: 'systemSettings/helpPageLink'\n  },\n  user: {\n    resource: 'me',\n    params: {\n      fields: ['authorities', 'avatar', 'email', 'name', 'settings']\n    }\n  },\n  apps: {\n    resource: 'action::menu/getModules'\n  },\n  notifications: {\n    resource: 'me/dashboard'\n  }\n};\n\nconst avatarUrl = (avatar, baseUrl) => avatar ? joinPath(baseUrl, 'api/fileResources', avatar.id, 'data') : null;\n\nexport const HeaderBar = ({\n  appName,\n  className\n}) => {\n  const {\n    baseUrl\n  } = useConfig();\n  const {\n    loading,\n    error,\n    data\n  } = useDataQuery(query);\n  const apps = useMemo(() => {\n    const getPath = path => path.startsWith('http:') || path.startsWith('https:') ? path : joinPath(baseUrl, 'api', path);\n\n    return data === null || data === void 0 ? void 0 : data.apps.modules.map(app => ({ ...app,\n      icon: getPath(app.icon),\n      defaultAction: getPath(app.defaultAction)\n    }));\n  }, [data]);\n\n  if (!loading && !error) {\n    // TODO: This will run every render which is probably wrong!  Also, setting the global locale shouldn't be done in the headerbar\n    const locale = data.user.settings.keyUiLocale || 'en';\n    i18n.setDefaultNamespace('default');\n    i18n.changeLanguage(locale);\n  }\n\n  return /*#__PURE__*/React.createElement(\"header\", {\n    className: _JSXStyle.dynamic([[\"1335571883\", [colors.white]]]) + \" \" + (className || \"\")\n  }, !loading && !error && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Logo, null), /*#__PURE__*/React.createElement(Title, {\n    app: appName,\n    instance: data.title.applicationTitle\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: _JSXStyle.dynamic([[\"1335571883\", [colors.white]]]) + \" \" + \"right-control-spacer\"\n  }), /*#__PURE__*/React.createElement(Notifications, {\n    interpretations: data.notifications.unreadInterpretations,\n    messages: data.notifications.unreadMessageConversations,\n    userAuthorities: data.user.authorities\n  }), /*#__PURE__*/React.createElement(Apps, {\n    apps: apps\n  }), /*#__PURE__*/React.createElement(Profile, {\n    name: data.user.name,\n    email: data.user.email,\n    avatarUrl: avatarUrl(data.user.avatar, baseUrl),\n    helpUrl: data.help.helpPageLink\n  })), /*#__PURE__*/React.createElement(_JSXStyle, {\n    id: \"1335571883\",\n    dynamic: [colors.white]\n  }, [\"header.__jsx-style-dynamic-selector{background-color:#2c6693;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;height:48px;border-bottom:1px solid rgba(32,32,32,0.15);color:\".concat(colors.white, \";}\"), \".right-control-spacer.__jsx-style-dynamic-selector{margin-left:auto;}\"]));\n};\nHeaderBar.propTypes = {\n  appName: PropTypes.string,\n  className: PropTypes.string\n};"]},"metadata":{},"sourceType":"module"}