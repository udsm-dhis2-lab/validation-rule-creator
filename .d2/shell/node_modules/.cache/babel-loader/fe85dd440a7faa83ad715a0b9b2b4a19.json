{"ast":null,"code":"var _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {\n  return typeof obj;\n} : function (obj) {\n  return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n};\n\nfunction _defaults(obj, defaults) {\n  var keys = Object.getOwnPropertyNames(defaults);\n\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    var value = Object.getOwnPropertyDescriptor(defaults, key);\n\n    if (value && value.configurable && obj[key] === undefined) {\n      Object.defineProperty(obj, key, value);\n    }\n  }\n\n  return obj;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : _defaults(subClass, superClass);\n}\n\nimport baseLogger from './logger.js';\nimport EventEmitter from './EventEmitter.js';\nimport postProcessor from './postProcessor.js';\nimport * as utils from './utils.js';\n\nvar Translator = function (_EventEmitter) {\n  _inherits(Translator, _EventEmitter);\n\n  function Translator(services) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    _classCallCheck(this, Translator);\n\n    var _this = _possibleConstructorReturn(this, _EventEmitter.call(this));\n\n    utils.copy(['resourceStore', 'languageUtils', 'pluralResolver', 'interpolator', 'backendConnector'], services, _this);\n    _this.options = options;\n    _this.logger = baseLogger.create('translator');\n    return _this;\n  }\n\n  Translator.prototype.changeLanguage = function changeLanguage(lng) {\n    if (lng) this.language = lng;\n  };\n\n  Translator.prototype.exists = function exists(key) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n      interpolation: {}\n    };\n    var resolved = this.resolve(key, options);\n    return resolved && resolved.res !== undefined;\n  };\n\n  Translator.prototype.extractFromKey = function extractFromKey(key, options) {\n    var nsSeparator = options.nsSeparator || this.options.nsSeparator;\n    if (nsSeparator === undefined) nsSeparator = ':';\n    var keySeparator = options.keySeparator || this.options.keySeparator || '.';\n    var namespaces = options.ns || this.options.defaultNS;\n\n    if (nsSeparator && key.indexOf(nsSeparator) > -1) {\n      var parts = key.split(nsSeparator);\n      if (nsSeparator !== keySeparator || nsSeparator === keySeparator && this.options.ns.indexOf(parts[0]) > -1) namespaces = parts.shift();\n      key = parts.join(keySeparator);\n    }\n\n    if (typeof namespaces === 'string') namespaces = [namespaces];\n    return {\n      key: key,\n      namespaces: namespaces\n    };\n  };\n\n  Translator.prototype.translate = function translate(keys, options) {\n    var _this2 = this;\n\n    if ((typeof options === 'undefined' ? 'undefined' : _typeof(options)) !== 'object' && this.options.overloadTranslationOptionHandler) {\n      /* eslint prefer-rest-params: 0 */\n      options = this.options.overloadTranslationOptionHandler(arguments);\n    }\n\n    if (!options) options = {}; // non valid keys handling\n\n    if (keys === undefined || keys === null || keys === '') return '';\n    if (typeof keys === 'number') keys = String(keys);\n    if (typeof keys === 'string') keys = [keys]; // separators\n\n    var keySeparator = options.keySeparator || this.options.keySeparator || '.'; // get namespace(s)\n\n    var _extractFromKey = this.extractFromKey(keys[keys.length - 1], options),\n        key = _extractFromKey.key,\n        namespaces = _extractFromKey.namespaces;\n\n    var namespace = namespaces[namespaces.length - 1]; // return key on CIMode\n\n    var lng = options.lng || this.language;\n    var appendNamespaceToCIMode = options.appendNamespaceToCIMode || this.options.appendNamespaceToCIMode;\n\n    if (lng && lng.toLowerCase() === 'cimode') {\n      if (appendNamespaceToCIMode) {\n        var nsSeparator = options.nsSeparator || this.options.nsSeparator;\n        return namespace + nsSeparator + key;\n      }\n\n      return key;\n    } // resolve from store\n\n\n    var resolved = this.resolve(keys, options);\n    var res = resolved && resolved.res;\n    var resUsedKey = resolved && resolved.usedKey || key;\n    var resType = Object.prototype.toString.apply(res);\n    var noObject = ['[object Number]', '[object Function]', '[object RegExp]'];\n    var joinArrays = options.joinArrays !== undefined ? options.joinArrays : this.options.joinArrays; // object\n\n    var handleAsObject = typeof res !== 'string' && typeof res !== 'boolean' && typeof res !== 'number';\n\n    if (res && handleAsObject && noObject.indexOf(resType) < 0 && !(joinArrays && resType === '[object Array]')) {\n      if (!options.returnObjects && !this.options.returnObjects) {\n        this.logger.warn('accessing an object - but returnObjects options is not enabled!');\n        return this.options.returnedObjectHandler ? this.options.returnedObjectHandler(resUsedKey, res, options) : 'key \\'' + key + ' (' + this.language + ')\\' returned an object instead of string.';\n      } // if we got a separator we loop over children - else we just return object as is\n      // as having it set to false means no hierarchy so no lookup for nested values\n\n\n      if (options.keySeparator || this.options.keySeparator) {\n        var copy = resType === '[object Array]' ? [] : {}; // apply child translation on a copy\n\n        /* eslint no-restricted-syntax: 0 */\n\n        for (var m in res) {\n          if (Object.prototype.hasOwnProperty.call(res, m)) {\n            var deepKey = '' + resUsedKey + keySeparator + m;\n            copy[m] = this.translate(deepKey, _extends({}, options, {\n              joinArrays: false,\n              ns: namespaces\n            }));\n            if (copy[m] === deepKey) copy[m] = res[m]; // if nothing found use orginal value as fallback\n          }\n        }\n\n        res = copy;\n      }\n    } else if (joinArrays && resType === '[object Array]') {\n      // array special treatment\n      res = res.join(joinArrays);\n      if (res) res = this.extendTranslation(res, keys, options);\n    } else {\n      // string, empty or null\n      var usedDefault = false;\n      var usedKey = false; // fallback value\n\n      if (!this.isValidLookup(res) && options.defaultValue !== undefined) {\n        usedDefault = true;\n        res = options.defaultValue;\n      }\n\n      if (!this.isValidLookup(res)) {\n        usedKey = true;\n        res = key;\n      } // save missing\n\n\n      var updateMissing = options.defaultValue && options.defaultValue !== res && this.options.updateMissing;\n\n      if (usedKey || usedDefault || updateMissing) {\n        this.logger.log(updateMissing ? 'updateKey' : 'missingKey', lng, namespace, key, updateMissing ? options.defaultValue : res);\n        var lngs = [];\n        var fallbackLngs = this.languageUtils.getFallbackCodes(this.options.fallbackLng, options.lng || this.language);\n\n        if (this.options.saveMissingTo === 'fallback' && fallbackLngs && fallbackLngs[0]) {\n          for (var i = 0; i < fallbackLngs.length; i++) {\n            lngs.push(fallbackLngs[i]);\n          }\n        } else if (this.options.saveMissingTo === 'all') {\n          lngs = this.languageUtils.toResolveHierarchy(options.lng || this.language);\n        } else {\n          lngs.push(options.lng || this.language);\n        }\n\n        var send = function send(l, k) {\n          if (_this2.options.missingKeyHandler) {\n            _this2.options.missingKeyHandler(l, namespace, k, updateMissing ? options.defaultValue : res, updateMissing, options);\n          } else if (_this2.backendConnector && _this2.backendConnector.saveMissing) {\n            _this2.backendConnector.saveMissing(l, namespace, k, updateMissing ? options.defaultValue : res, updateMissing, options);\n          }\n\n          _this2.emit('missingKey', l, namespace, k, res);\n        };\n\n        if (this.options.saveMissing) {\n          if (this.options.saveMissingPlurals && options.count) {\n            lngs.forEach(function (l) {\n              var plurals = _this2.pluralResolver.getPluralFormsOfKey(l, key);\n\n              plurals.forEach(function (p) {\n                return send([l], p);\n              });\n            });\n          } else {\n            send(lngs, key);\n          }\n        }\n      } // extend\n\n\n      res = this.extendTranslation(res, keys, options); // append namespace if still key\n\n      if (usedKey && res === key && this.options.appendNamespaceToMissingKey) res = namespace + ':' + key; // parseMissingKeyHandler\n\n      if (usedKey && this.options.parseMissingKeyHandler) res = this.options.parseMissingKeyHandler(res);\n    } // return\n\n\n    return res;\n  };\n\n  Translator.prototype.extendTranslation = function extendTranslation(res, key, options) {\n    var _this3 = this;\n\n    if (options.interpolation) this.interpolator.init(_extends({}, options, {\n      interpolation: _extends({}, this.options.interpolation, options.interpolation)\n    })); // interpolate\n\n    var data = options.replace && typeof options.replace !== 'string' ? options.replace : options;\n    if (this.options.interpolation.defaultVariables) data = _extends({}, this.options.interpolation.defaultVariables, data);\n    res = this.interpolator.interpolate(res, data, options.lng || this.language); // nesting\n\n    if (options.nest !== false) res = this.interpolator.nest(res, function () {\n      return _this3.translate.apply(_this3, arguments);\n    }, options);\n    if (options.interpolation) this.interpolator.reset(); // post process\n\n    var postProcess = options.postProcess || this.options.postProcess;\n    var postProcessorNames = typeof postProcess === 'string' ? [postProcess] : postProcess;\n\n    if (res !== undefined && res !== null && postProcessorNames && postProcessorNames.length && options.applyPostProcessor !== false) {\n      res = postProcessor.handle(postProcessorNames, res, key, options, this);\n    }\n\n    return res;\n  };\n\n  Translator.prototype.resolve = function resolve(keys) {\n    var _this4 = this;\n\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var found = void 0;\n    var usedKey = void 0;\n    if (typeof keys === 'string') keys = [keys]; // forEach possible key\n\n    keys.forEach(function (k) {\n      if (_this4.isValidLookup(found)) return;\n\n      var extracted = _this4.extractFromKey(k, options);\n\n      var key = extracted.key;\n      usedKey = key;\n      var namespaces = extracted.namespaces;\n      if (_this4.options.fallbackNS) namespaces = namespaces.concat(_this4.options.fallbackNS);\n      var needsPluralHandling = options.count !== undefined && typeof options.count !== 'string';\n      var needsContextHandling = options.context !== undefined && typeof options.context === 'string' && options.context !== '';\n      var codes = options.lngs ? options.lngs : _this4.languageUtils.toResolveHierarchy(options.lng || _this4.language);\n      namespaces.forEach(function (ns) {\n        if (_this4.isValidLookup(found)) return;\n        codes.forEach(function (code) {\n          if (_this4.isValidLookup(found)) return;\n          var finalKey = key;\n          var finalKeys = [finalKey];\n          var pluralSuffix = void 0;\n          if (needsPluralHandling) pluralSuffix = _this4.pluralResolver.getSuffix(code, options.count); // fallback for plural if context not found\n\n          if (needsPluralHandling && needsContextHandling) finalKeys.push(finalKey + pluralSuffix); // get key for context if needed\n\n          if (needsContextHandling) finalKeys.push(finalKey += '' + _this4.options.contextSeparator + options.context); // get key for plural if needed\n\n          if (needsPluralHandling) finalKeys.push(finalKey += pluralSuffix); // iterate over finalKeys starting with most specific pluralkey (-> contextkey only) -> singularkey only\n\n          var possibleKey = void 0;\n          /* eslint no-cond-assign: 0 */\n\n          while (possibleKey = finalKeys.pop()) {\n            if (!_this4.isValidLookup(found)) {\n              found = _this4.getResource(code, ns, possibleKey, options);\n            }\n          }\n        });\n      });\n    });\n    return {\n      res: found,\n      usedKey: usedKey\n    };\n  };\n\n  Translator.prototype.isValidLookup = function isValidLookup(res) {\n    return res !== undefined && !(!this.options.returnNull && res === null) && !(!this.options.returnEmptyString && res === '');\n  };\n\n  Translator.prototype.getResource = function getResource(code, ns, key) {\n    var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n    return this.resourceStore.getResource(code, ns, key, options);\n  };\n\n  return Translator;\n}(EventEmitter);\n\nexport default Translator;","map":{"version":3,"sources":["/Users/rajabu/.config/yarn/global/node_modules/@dhis2/d2-i18n/node_modules/i18next/dist/es/Translator.js"],"names":["_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","_typeof","Symbol","iterator","obj","constructor","_defaults","defaults","keys","getOwnPropertyNames","value","getOwnPropertyDescriptor","configurable","undefined","defineProperty","_classCallCheck","instance","Constructor","TypeError","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","create","enumerable","writable","setPrototypeOf","baseLogger","EventEmitter","postProcessor","utils","Translator","_EventEmitter","services","options","_this","copy","logger","changeLanguage","lng","language","exists","interpolation","resolved","resolve","res","extractFromKey","nsSeparator","keySeparator","namespaces","ns","defaultNS","indexOf","parts","split","shift","join","translate","_this2","overloadTranslationOptionHandler","String","_extractFromKey","namespace","appendNamespaceToCIMode","toLowerCase","resUsedKey","usedKey","resType","toString","apply","noObject","joinArrays","handleAsObject","returnObjects","warn","returnedObjectHandler","m","deepKey","extendTranslation","usedDefault","isValidLookup","defaultValue","updateMissing","log","lngs","fallbackLngs","languageUtils","getFallbackCodes","fallbackLng","saveMissingTo","push","toResolveHierarchy","send","l","k","missingKeyHandler","backendConnector","saveMissing","emit","saveMissingPlurals","count","forEach","plurals","pluralResolver","getPluralFormsOfKey","p","appendNamespaceToMissingKey","parseMissingKeyHandler","_this3","interpolator","init","data","replace","defaultVariables","interpolate","nest","reset","postProcess","postProcessorNames","applyPostProcessor","handle","_this4","found","extracted","fallbackNS","concat","needsPluralHandling","needsContextHandling","context","codes","code","finalKey","finalKeys","pluralSuffix","getSuffix","contextSeparator","possibleKey","pop","getResource","returnNull","returnEmptyString","resourceStore"],"mappings":"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","sourcesContent":["var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nfunction _defaults(obj, defaults) { var keys = Object.getOwnPropertyNames(defaults); for (var i = 0; i < keys.length; i++) { var key = keys[i]; var value = Object.getOwnPropertyDescriptor(defaults, key); if (value && value.configurable && obj[key] === undefined) { Object.defineProperty(obj, key, value); } } return obj; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : _defaults(subClass, superClass); }\n\nimport baseLogger from './logger.js';\nimport EventEmitter from './EventEmitter.js';\nimport postProcessor from './postProcessor.js';\nimport * as utils from './utils.js';\n\nvar Translator = function (_EventEmitter) {\n  _inherits(Translator, _EventEmitter);\n\n  function Translator(services) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    _classCallCheck(this, Translator);\n\n    var _this = _possibleConstructorReturn(this, _EventEmitter.call(this));\n\n    utils.copy(['resourceStore', 'languageUtils', 'pluralResolver', 'interpolator', 'backendConnector'], services, _this);\n\n    _this.options = options;\n    _this.logger = baseLogger.create('translator');\n    return _this;\n  }\n\n  Translator.prototype.changeLanguage = function changeLanguage(lng) {\n    if (lng) this.language = lng;\n  };\n\n  Translator.prototype.exists = function exists(key) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : { interpolation: {} };\n\n    var resolved = this.resolve(key, options);\n    return resolved && resolved.res !== undefined;\n  };\n\n  Translator.prototype.extractFromKey = function extractFromKey(key, options) {\n    var nsSeparator = options.nsSeparator || this.options.nsSeparator;\n    if (nsSeparator === undefined) nsSeparator = ':';\n    var keySeparator = options.keySeparator || this.options.keySeparator || '.';\n\n    var namespaces = options.ns || this.options.defaultNS;\n    if (nsSeparator && key.indexOf(nsSeparator) > -1) {\n      var parts = key.split(nsSeparator);\n      if (nsSeparator !== keySeparator || nsSeparator === keySeparator && this.options.ns.indexOf(parts[0]) > -1) namespaces = parts.shift();\n      key = parts.join(keySeparator);\n    }\n    if (typeof namespaces === 'string') namespaces = [namespaces];\n\n    return {\n      key: key,\n      namespaces: namespaces\n    };\n  };\n\n  Translator.prototype.translate = function translate(keys, options) {\n    var _this2 = this;\n\n    if ((typeof options === 'undefined' ? 'undefined' : _typeof(options)) !== 'object' && this.options.overloadTranslationOptionHandler) {\n      /* eslint prefer-rest-params: 0 */\n      options = this.options.overloadTranslationOptionHandler(arguments);\n    }\n    if (!options) options = {};\n\n    // non valid keys handling\n    if (keys === undefined || keys === null || keys === '') return '';\n    if (typeof keys === 'number') keys = String(keys);\n    if (typeof keys === 'string') keys = [keys];\n\n    // separators\n    var keySeparator = options.keySeparator || this.options.keySeparator || '.';\n\n    // get namespace(s)\n\n    var _extractFromKey = this.extractFromKey(keys[keys.length - 1], options),\n        key = _extractFromKey.key,\n        namespaces = _extractFromKey.namespaces;\n\n    var namespace = namespaces[namespaces.length - 1];\n\n    // return key on CIMode\n    var lng = options.lng || this.language;\n    var appendNamespaceToCIMode = options.appendNamespaceToCIMode || this.options.appendNamespaceToCIMode;\n    if (lng && lng.toLowerCase() === 'cimode') {\n      if (appendNamespaceToCIMode) {\n        var nsSeparator = options.nsSeparator || this.options.nsSeparator;\n        return namespace + nsSeparator + key;\n      }\n\n      return key;\n    }\n\n    // resolve from store\n    var resolved = this.resolve(keys, options);\n    var res = resolved && resolved.res;\n    var resUsedKey = resolved && resolved.usedKey || key;\n\n    var resType = Object.prototype.toString.apply(res);\n    var noObject = ['[object Number]', '[object Function]', '[object RegExp]'];\n    var joinArrays = options.joinArrays !== undefined ? options.joinArrays : this.options.joinArrays;\n\n    // object\n    var handleAsObject = typeof res !== 'string' && typeof res !== 'boolean' && typeof res !== 'number';\n    if (res && handleAsObject && noObject.indexOf(resType) < 0 && !(joinArrays && resType === '[object Array]')) {\n      if (!options.returnObjects && !this.options.returnObjects) {\n        this.logger.warn('accessing an object - but returnObjects options is not enabled!');\n        return this.options.returnedObjectHandler ? this.options.returnedObjectHandler(resUsedKey, res, options) : 'key \\'' + key + ' (' + this.language + ')\\' returned an object instead of string.';\n      }\n\n      // if we got a separator we loop over children - else we just return object as is\n      // as having it set to false means no hierarchy so no lookup for nested values\n      if (options.keySeparator || this.options.keySeparator) {\n        var copy = resType === '[object Array]' ? [] : {}; // apply child translation on a copy\n\n        /* eslint no-restricted-syntax: 0 */\n        for (var m in res) {\n          if (Object.prototype.hasOwnProperty.call(res, m)) {\n            var deepKey = '' + resUsedKey + keySeparator + m;\n            copy[m] = this.translate(deepKey, _extends({}, options, { joinArrays: false, ns: namespaces }));\n            if (copy[m] === deepKey) copy[m] = res[m]; // if nothing found use orginal value as fallback\n          }\n        }\n        res = copy;\n      }\n    } else if (joinArrays && resType === '[object Array]') {\n      // array special treatment\n      res = res.join(joinArrays);\n      if (res) res = this.extendTranslation(res, keys, options);\n    } else {\n      // string, empty or null\n      var usedDefault = false;\n      var usedKey = false;\n\n      // fallback value\n      if (!this.isValidLookup(res) && options.defaultValue !== undefined) {\n        usedDefault = true;\n        res = options.defaultValue;\n      }\n      if (!this.isValidLookup(res)) {\n        usedKey = true;\n        res = key;\n      }\n\n      // save missing\n      var updateMissing = options.defaultValue && options.defaultValue !== res && this.options.updateMissing;\n      if (usedKey || usedDefault || updateMissing) {\n        this.logger.log(updateMissing ? 'updateKey' : 'missingKey', lng, namespace, key, updateMissing ? options.defaultValue : res);\n\n        var lngs = [];\n        var fallbackLngs = this.languageUtils.getFallbackCodes(this.options.fallbackLng, options.lng || this.language);\n        if (this.options.saveMissingTo === 'fallback' && fallbackLngs && fallbackLngs[0]) {\n          for (var i = 0; i < fallbackLngs.length; i++) {\n            lngs.push(fallbackLngs[i]);\n          }\n        } else if (this.options.saveMissingTo === 'all') {\n          lngs = this.languageUtils.toResolveHierarchy(options.lng || this.language);\n        } else {\n          lngs.push(options.lng || this.language);\n        }\n\n        var send = function send(l, k) {\n          if (_this2.options.missingKeyHandler) {\n            _this2.options.missingKeyHandler(l, namespace, k, updateMissing ? options.defaultValue : res, updateMissing, options);\n          } else if (_this2.backendConnector && _this2.backendConnector.saveMissing) {\n            _this2.backendConnector.saveMissing(l, namespace, k, updateMissing ? options.defaultValue : res, updateMissing, options);\n          }\n          _this2.emit('missingKey', l, namespace, k, res);\n        };\n\n        if (this.options.saveMissing) {\n          if (this.options.saveMissingPlurals && options.count) {\n            lngs.forEach(function (l) {\n              var plurals = _this2.pluralResolver.getPluralFormsOfKey(l, key);\n\n              plurals.forEach(function (p) {\n                return send([l], p);\n              });\n            });\n          } else {\n            send(lngs, key);\n          }\n        }\n      }\n\n      // extend\n      res = this.extendTranslation(res, keys, options);\n\n      // append namespace if still key\n      if (usedKey && res === key && this.options.appendNamespaceToMissingKey) res = namespace + ':' + key;\n\n      // parseMissingKeyHandler\n      if (usedKey && this.options.parseMissingKeyHandler) res = this.options.parseMissingKeyHandler(res);\n    }\n\n    // return\n    return res;\n  };\n\n  Translator.prototype.extendTranslation = function extendTranslation(res, key, options) {\n    var _this3 = this;\n\n    if (options.interpolation) this.interpolator.init(_extends({}, options, { interpolation: _extends({}, this.options.interpolation, options.interpolation) }));\n\n    // interpolate\n    var data = options.replace && typeof options.replace !== 'string' ? options.replace : options;\n    if (this.options.interpolation.defaultVariables) data = _extends({}, this.options.interpolation.defaultVariables, data);\n    res = this.interpolator.interpolate(res, data, options.lng || this.language);\n\n    // nesting\n    if (options.nest !== false) res = this.interpolator.nest(res, function () {\n      return _this3.translate.apply(_this3, arguments);\n    }, options);\n\n    if (options.interpolation) this.interpolator.reset();\n\n    // post process\n    var postProcess = options.postProcess || this.options.postProcess;\n    var postProcessorNames = typeof postProcess === 'string' ? [postProcess] : postProcess;\n\n    if (res !== undefined && res !== null && postProcessorNames && postProcessorNames.length && options.applyPostProcessor !== false) {\n      res = postProcessor.handle(postProcessorNames, res, key, options, this);\n    }\n\n    return res;\n  };\n\n  Translator.prototype.resolve = function resolve(keys) {\n    var _this4 = this;\n\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    var found = void 0;\n    var usedKey = void 0;\n\n    if (typeof keys === 'string') keys = [keys];\n\n    // forEach possible key\n    keys.forEach(function (k) {\n      if (_this4.isValidLookup(found)) return;\n      var extracted = _this4.extractFromKey(k, options);\n      var key = extracted.key;\n      usedKey = key;\n      var namespaces = extracted.namespaces;\n      if (_this4.options.fallbackNS) namespaces = namespaces.concat(_this4.options.fallbackNS);\n\n      var needsPluralHandling = options.count !== undefined && typeof options.count !== 'string';\n      var needsContextHandling = options.context !== undefined && typeof options.context === 'string' && options.context !== '';\n\n      var codes = options.lngs ? options.lngs : _this4.languageUtils.toResolveHierarchy(options.lng || _this4.language);\n\n      namespaces.forEach(function (ns) {\n        if (_this4.isValidLookup(found)) return;\n\n        codes.forEach(function (code) {\n          if (_this4.isValidLookup(found)) return;\n\n          var finalKey = key;\n          var finalKeys = [finalKey];\n\n          var pluralSuffix = void 0;\n          if (needsPluralHandling) pluralSuffix = _this4.pluralResolver.getSuffix(code, options.count);\n\n          // fallback for plural if context not found\n          if (needsPluralHandling && needsContextHandling) finalKeys.push(finalKey + pluralSuffix);\n\n          // get key for context if needed\n          if (needsContextHandling) finalKeys.push(finalKey += '' + _this4.options.contextSeparator + options.context);\n\n          // get key for plural if needed\n          if (needsPluralHandling) finalKeys.push(finalKey += pluralSuffix);\n\n          // iterate over finalKeys starting with most specific pluralkey (-> contextkey only) -> singularkey only\n          var possibleKey = void 0;\n          /* eslint no-cond-assign: 0 */\n          while (possibleKey = finalKeys.pop()) {\n            if (!_this4.isValidLookup(found)) {\n              found = _this4.getResource(code, ns, possibleKey, options);\n            }\n          }\n        });\n      });\n    });\n\n    return { res: found, usedKey: usedKey };\n  };\n\n  Translator.prototype.isValidLookup = function isValidLookup(res) {\n    return res !== undefined && !(!this.options.returnNull && res === null) && !(!this.options.returnEmptyString && res === '');\n  };\n\n  Translator.prototype.getResource = function getResource(code, ns, key) {\n    var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n\n    return this.resourceStore.getResource(code, ns, key, options);\n  };\n\n  return Translator;\n}(EventEmitter);\n\nexport default Translator;"]},"metadata":{},"sourceType":"module"}