{"ast":null,"code":"import { Modal, ModalTitle, ModalContent, ModalActions, Button, InputField } from '@dhis2/ui';\nimport React, { useState } from 'react';\nimport i18n from '../locales';\nimport { post } from '../utils/api';\nconst staticUrl = process.env.REACT_APP_DHIS2_BASE_URL;\nexport const LoginModal = () => {\n  const [server, setServer] = useState(staticUrl || window.localStorage.DHIS2_BASE_URL || '');\n  const [username, setUsername] = useState('');\n  const [password, setPassword] = useState('');\n  const [isDirty, setIsDirty] = useState(false);\n\n  const isValid = val => val && val.length >= 2;\n\n  const onSubmit = async e => {\n    e.preventDefault();\n    setIsDirty(true);\n\n    if (isValid(server) && isValid(username) && isValid(password)) {\n      window.localStorage.DHIS2_BASE_URL = server;\n\n      try {\n        await post(\"\".concat(server, \"/dhis-web-commons-security/login.action\"), \"j_username=\".concat(encodeURIComponent(username), \"&j_password=\").concat(encodeURIComponent(password)));\n      } catch (e) {\n        console.log('TODO: This will always error and cancel the request until we get a real login endpoint!');\n      } // TODO: Hacky solution... this shouldn't require a reload\n\n\n      window.location.reload();\n    }\n  };\n\n  return /*#__PURE__*/React.createElement(Modal, {\n    open: true,\n    small: true,\n    dataTest: \"dhis2-adapter-loginmodal\"\n  }, /*#__PURE__*/React.createElement(\"form\", {\n    onSubmit: onSubmit\n  }, /*#__PURE__*/React.createElement(ModalTitle, null, i18n.t('Please sign in')), /*#__PURE__*/React.createElement(ModalContent, null, !staticUrl && /*#__PURE__*/React.createElement(InputField, {\n    dataTest: \"dhis2-adapter-loginserver\",\n    error: isDirty && !isValid(server),\n    label: i18n.t('Server'),\n    name: \"server\",\n    type: \"text\",\n    value: server,\n    onChange: input => setServer(input.value)\n  }), /*#__PURE__*/React.createElement(InputField, {\n    dataTest: \"dhis2-adapter-loginname\",\n    error: isDirty && !isValid(username),\n    label: i18n.t('Username'),\n    name: \"j_username\",\n    type: \"text\",\n    value: username,\n    onChange: input => setUsername(input.value)\n  }), /*#__PURE__*/React.createElement(InputField, {\n    dataTest: \"dhis2-adapter-loginpassword\",\n    error: isDirty && !isValid(password),\n    label: i18n.t('Password'),\n    name: \"j_password\",\n    type: \"password\",\n    value: password,\n    onChange: input => setPassword(input.value)\n  })), /*#__PURE__*/React.createElement(ModalActions, null, /*#__PURE__*/React.createElement(Button, {\n    primary: true,\n    dataTest: \"dhis2-adapter-loginsubmit\",\n    type: \"submit\"\n  }, i18n.t('Sign in')))));\n};","map":{"version":3,"sources":["/Users/rajabu/.config/yarn/global/node_modules/@dhis2/app-shell/node_modules/@dhis2/app-adapter/build/es/components/LoginModal.js"],"names":["Modal","ModalTitle","ModalContent","ModalActions","Button","InputField","React","useState","i18n","post","staticUrl","process","env","REACT_APP_DHIS2_BASE_URL","LoginModal","server","setServer","window","localStorage","DHIS2_BASE_URL","username","setUsername","password","setPassword","isDirty","setIsDirty","isValid","val","length","onSubmit","e","preventDefault","concat","encodeURIComponent","console","log","location","reload","createElement","open","small","dataTest","t","error","label","name","type","value","onChange","input","primary"],"mappings":"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","sourcesContent":["import { Modal, ModalTitle, ModalContent, ModalActions, Button, InputField } from '@dhis2/ui';\nimport React, { useState } from 'react';\nimport i18n from '../locales';\nimport { post } from '../utils/api';\nconst staticUrl = process.env.REACT_APP_DHIS2_BASE_URL;\nexport const LoginModal = () => {\n  const [server, setServer] = useState(staticUrl || window.localStorage.DHIS2_BASE_URL || '');\n  const [username, setUsername] = useState('');\n  const [password, setPassword] = useState('');\n  const [isDirty, setIsDirty] = useState(false);\n\n  const isValid = val => val && val.length >= 2;\n\n  const onSubmit = async e => {\n    e.preventDefault();\n    setIsDirty(true);\n\n    if (isValid(server) && isValid(username) && isValid(password)) {\n      window.localStorage.DHIS2_BASE_URL = server;\n\n      try {\n        await post(\"\".concat(server, \"/dhis-web-commons-security/login.action\"), \"j_username=\".concat(encodeURIComponent(username), \"&j_password=\").concat(encodeURIComponent(password)));\n      } catch (e) {\n        console.log('TODO: This will always error and cancel the request until we get a real login endpoint!');\n      } // TODO: Hacky solution... this shouldn't require a reload\n\n\n      window.location.reload();\n    }\n  };\n\n  return /*#__PURE__*/React.createElement(Modal, {\n    open: true,\n    small: true,\n    dataTest: \"dhis2-adapter-loginmodal\"\n  }, /*#__PURE__*/React.createElement(\"form\", {\n    onSubmit: onSubmit\n  }, /*#__PURE__*/React.createElement(ModalTitle, null, i18n.t('Please sign in')), /*#__PURE__*/React.createElement(ModalContent, null, !staticUrl && /*#__PURE__*/React.createElement(InputField, {\n    dataTest: \"dhis2-adapter-loginserver\",\n    error: isDirty && !isValid(server),\n    label: i18n.t('Server'),\n    name: \"server\",\n    type: \"text\",\n    value: server,\n    onChange: input => setServer(input.value)\n  }), /*#__PURE__*/React.createElement(InputField, {\n    dataTest: \"dhis2-adapter-loginname\",\n    error: isDirty && !isValid(username),\n    label: i18n.t('Username'),\n    name: \"j_username\",\n    type: \"text\",\n    value: username,\n    onChange: input => setUsername(input.value)\n  }), /*#__PURE__*/React.createElement(InputField, {\n    dataTest: \"dhis2-adapter-loginpassword\",\n    error: isDirty && !isValid(password),\n    label: i18n.t('Password'),\n    name: \"j_password\",\n    type: \"password\",\n    value: password,\n    onChange: input => setPassword(input.value)\n  })), /*#__PURE__*/React.createElement(ModalActions, null, /*#__PURE__*/React.createElement(Button, {\n    primary: true,\n    dataTest: \"dhis2-adapter-loginsubmit\",\n    type: \"submit\"\n  }, i18n.t('Sign in')))));\n};"]},"metadata":{},"sourceType":"module"}