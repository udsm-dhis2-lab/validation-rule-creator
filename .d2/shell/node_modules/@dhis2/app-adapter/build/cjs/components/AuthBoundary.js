"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.AuthBoundary = void 0;

var _appRuntime = require("@dhis2/app-runtime");

var _propTypes = _interopRequireDefault(require("prop-types"));

var _react = _interopRequireDefault(require("react"));

var _useLocale = require("../utils/useLocale");

var _LoadingMask = require("./LoadingMask");

var _LoginModal = require("./LoginModal");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const settingsQuery = {
  userSettings: {
    resource: 'userSettings'
  }
};

const AuthBoundary = ({
  url,
  children
}) => {
  const {
    loading,
    error,
    data
  } = (0, _appRuntime.useDataQuery)(settingsQuery);
  const locale = (0, _useLocale.useLocale)(data && (data.userSettings.keyUiLocale || window.navigator.language));

  if (error) {
    return /*#__PURE__*/_react.default.createElement(_LoginModal.LoginModal, {
      url: url
    });
  }

  if (loading || !locale) {
    return /*#__PURE__*/_react.default.createElement(_LoadingMask.LoadingMask, null);
  }

  return children;
};

exports.AuthBoundary = AuthBoundary;
AuthBoundary.propTypes = {
  children: _propTypes.default.element,
  url: _propTypes.default.string
};